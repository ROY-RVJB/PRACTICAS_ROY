import os
import shutil
from pathlib import Path

def copiar_proyecto_sin_node_modules(origen, destino):
    """
    Copia un proyecto completo excluyendo las carpetas node_modules
    """
    def ignorar_node_modules(directorio, contenidos):
        """FunciÃ³n para ignorar carpetas node_modules"""
        return {'node_modules'} if 'node_modules' in contenidos else set()
    
    try:
        # Crear directorio destino si no existe
        Path(destino).mkdir(parents=True, exist_ok=True)
        
        # Copiar todo el contenido excluyendo node_modules
        shutil.copytree(origen, destino, ignore=ignorar_node_modules, dirs_exist_ok=True)
        
        print(f"âœ… Proyecto copiado exitosamente!")
        print(f"ğŸ“‚ Origen: {origen}")
        print(f"ğŸ“ Destino: {destino}")
        
        # Mostrar estadÃ­sticas
        mostrar_estadisticas(origen, destino)
        
    except Exception as e:
        print(f"âŒ Error al copiar el proyecto: {e}")

def mostrar_estadisticas(origen, destino):
    """Muestra estadÃ­sticas de la copia"""
    def contar_archivos_y_carpetas(ruta, excluir_node_modules=False):
        archivos = 0
        carpetas = 0
        for root, dirs, files in os.walk(ruta):
            if excluir_node_modules and 'node_modules' in dirs:
                dirs.remove('node_modules')  # No entrar en node_modules
            archivos += len(files)
            carpetas += len(dirs)
        return archivos, carpetas
    
    # Contar en origen (incluyendo node_modules)
    archivos_origen, carpetas_origen = contar_archivos_y_carpetas(origen, False)
    
    # Contar en destino (sin node_modules)
    archivos_destino, carpetas_destino = contar_archivos_y_carpetas(destino, True)
    
    print(f"\nğŸ“Š ESTADÃSTICAS:")
    print(f"   Original: {archivos_origen} archivos, {carpetas_origen} carpetas")
    print(f"   Copiado: {archivos_destino} archivos, {carpetas_destino} carpetas")
    print(f"   ReducciÃ³n: {archivos_origen - archivos_destino} archivos menos")

def crear_readme_instrucciones(destino):
    """Crea un README con instrucciones de instalaciÃ³n"""
    readme_content = """# ğŸ“¦ Proyecto sin node_modules

Este proyecto ha sido limpiado y no incluye las carpetas `node_modules`.

## ğŸš€ Instrucciones para tu compaÃ±ero:

### Para cada proyecto que tenga package.json:

1. **Navegar al directorio del proyecto:**
   ```bash
   cd nombre_del_proyecto
   ```

2. **Instalar dependencias:**
   ```bash
   npm install
   ```

3. **Ejecutar el proyecto:**
   ```bash
   npm run dev    # Para proyectos con Vite/React
   npm start      # Para otros proyectos
   ```

### Lista de proyectos que requieren npm install:
- 02-IntroReact/tienda
- 03-usuarios  
- 04-ecommerce
- listaUsers

## âœ… Ventajas de este mÃ©todo:
- âœ¨ Carpeta mucho mÃ¡s liviana para enviar
- ğŸ”„ Dependencias siempre actualizadas
- ğŸ›¡ï¸ Sin conflictos de versiones
- ğŸ“¦ InstalaciÃ³n limpia en cada mÃ¡quina

Â¡Listo para desarrollar! ğŸ‰
"""
    
    readme_path = Path(destino) / "README_INSTALACION.md"
    with open(readme_path, 'w', encoding='utf-8') as f:
        f.write(readme_content)
    
    print(f"ğŸ“ README de instrucciones creado: {readme_path}")

def main():
    # Rutas de origen y destino
    origen = r"C:\Users\User\Documents\CURSOS\DESARROLLO DE APLICACIONES WEB 1\PRACTICAS_ROY\clase_12"
    destino = r"C:\Users\User\Documents\CURSOS\DESARROLLO DE APLICACIONES WEB 1\PRACTICAS_ROY\clase_12_sin_node_modules"
    
    print("ğŸš€ INICIANDO COPIA DE PROYECTO SIN NODE_MODULES")
    print("=" * 60)
    
    # Verificar que la carpeta origen existe
    if not os.path.exists(origen):
        print(f"âŒ Error: La carpeta origen no existe: {origen}")
        return
    
    # Preguntar si quiere sobrescribir si ya existe
    if os.path.exists(destino):
        respuesta = input(f"âš ï¸  La carpeta {destino} ya existe. Â¿Sobrescribir? (s/n): ")
        if respuesta.lower() != 's':
            print("âŒ OperaciÃ³n cancelada.")
            return
        else:
            # Eliminar carpeta existente
            shutil.rmtree(destino)
            print("ğŸ—‘ï¸  Carpeta anterior eliminada.")
    
    # Copiar proyecto
    copiar_proyecto_sin_node_modules(origen, destino)
    
    # Crear README con instrucciones
    crear_readme_instrucciones(destino)
    
    print("\n" + "=" * 60)
    print("ğŸ‰ Â¡PROCESO COMPLETADO!")
    print(f"ğŸ“ Tu proyecto limpio estÃ¡ en: {destino}")
    print("ğŸ’¡ Comparte esta carpeta con tu compaÃ±ero.")

if __name__ == "__main__":
    main()
